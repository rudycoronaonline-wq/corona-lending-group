---
// Replace with your High Level CRM webhook URL
const HL_WEBHOOK = 'YOUR_HIGHLEVEL_WEBHOOK_URL';
---

<form
  id="contact-form"
  class="space-y-4 max-w-xl"
  method="post"
  action="#"
>
  <!-- Honeypot -->
  <div class="absolute -left-[9999px]" aria-hidden="true">
    <label for="website">Website</label>
    <input type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <div>
      <label for="first_name" class="block text-sm font-medium text-dark mb-1">First Name <span class="text-red-500">*</span></label>
      <input
        type="text"
        id="first_name"
        name="first_name"
        required
        class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition min-h-[44px]"
        autocomplete="given-name"
      />
    </div>
    <div>
      <label for="last_name" class="block text-sm font-medium text-dark mb-1">Last Name <span class="text-red-500">*</span></label>
      <input
        type="text"
        id="last_name"
        name="last_name"
        required
        class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition min-h-[44px]"
        autocomplete="family-name"
      />
    </div>
  </div>

  <div>
    <label for="email" class="block text-sm font-medium text-dark mb-1">Email <span class="text-red-500">*</span></label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition min-h-[44px]"
      autocomplete="email"
    />
    <p id="email-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address.</p>
  </div>

  <div>
    <label for="phone" class="block text-sm font-medium text-dark mb-1">Phone <span class="text-red-500">*</span></label>
    <input
      type="tel"
      id="phone"
      name="phone"
      required
      class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition min-h-[44px]"
      autocomplete="tel"
    />
    <p id="phone-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid phone number.</p>
  </div>

  <div>
    <label for="loan_type" class="block text-sm font-medium text-dark mb-1">Loan Type</label>
    <select
      id="loan_type"
      name="loan_type"
      class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition min-h-[44px]"
    >
      <option value="">Select...</option>
      <option value="Conventional">Conventional</option>
      <option value="FHA">FHA</option>
      <option value="DSCR">DSCR</option>
      <option value="Reverse Mortgage">Reverse Mortgage</option>
      <option value="Self-Employed">Self-Employed</option>
      <option value="Hard Money">Hard Money</option>
      <option value="Commercial">Commercial</option>
      <option value="Not Sure">Not Sure</option>
    </select>
  </div>

  <div>
    <label for="message" class="block text-sm font-medium text-dark mb-1">Message</label>
    <textarea
      id="message"
      name="message"
      rows="4"
      class="w-full px-4 py-3 rounded-lg border border-grey-light focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none transition"
    ></textarea>
  </div>

  <input type="hidden" name="source" value="website-contact-form" />

  <div id="form-message" class="hidden p-4 rounded-lg"></div>

  <button
    type="submit"
    class="w-full min-h-[44px] px-6 py-4 bg-sky-500 hover:bg-sky-600 text-white font-semibold rounded-lg transition-all duration-200 hover:scale-[1.02]"
  >
    Send Message & Get My Free Consultation
  </button>
</form>

<script define:vars={{ HL_WEBHOOK }}>
  const form = document.getElementById('contact-form');
  const messageEl = document.getElementById('form-message');
  const emailInput = document.getElementById('email');
  const phoneInput = document.getElementById('phone');
  const emailError = document.getElementById('email-error');
  const phoneError = document.getElementById('phone-error');

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const phoneRegex = /^[\d\s\-\(\)\+]{10,}$/;

  function showMessage(text, isError = false) {
    if (!messageEl) return;
    messageEl.textContent = text;
    messageEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
    messageEl.classList.add(isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800');
  }

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!messageEl || !emailInput || !phoneInput) return;

    emailError?.classList.add('hidden');
    phoneError?.classList.add('hidden');

    const honeypot = (form.querySelector('[name="website"]') as HTMLInputElement)?.value;
    if (honeypot) return;

    const email = (emailInput as HTMLInputElement).value.trim();
    const phone = (phoneInput as HTMLInputElement).value.trim();
    if (!emailRegex.test(email)) {
      emailError?.classList.remove('hidden');
      return;
    }
    if (!phoneRegex.test(phone.replace(/\D/g, '')) || phone.replace(/\D/g, '').length < 10) {
      phoneError?.classList.remove('hidden');
      return;
    }

    const formData = new FormData(form);
    const body = {
      first_name: formData.get('first_name'),
      last_name: formData.get('last_name'),
      email: formData.get('email'),
      phone: formData.get('phone'),
      loan_type: formData.get('loan_type'),
      message: formData.get('message'),
      source: 'website-contact-form',
    };

    try {
      const res = await fetch(HL_WEBHOOK, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      });
      if (res.ok) {
        showMessage('Thanks! Rudy will be in touch within 24 hours.');
        form.reset();
      } else {
        showMessage('Something went wrong. Please call us or try again later.', true);
      }
    } catch {
      showMessage('Something went wrong. Please call us or try again later.', true);
    }
  });
</script>
